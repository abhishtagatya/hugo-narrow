{{/*
  문서 라이선스 정보 컴포넌트
  문서의 저작권과 라이선스 정보를 표시합니다.
  @context {page} . 현재 문서 페이지 객체
*/}}

{{- if .Site.Params.post.license.show | default (.Params.license.show | default true) -}}

  {{/* 1. .Scratch를 사용하여 안전하게 라이선스 설정을 구축합니다. */}}
  {{/* 기본값 설정 */}}
  {{- .Scratch.Set "licenseConfig" (dict "name" "CC BY-NC-SA 4.0" "author" .Site.Params.author.name) -}}

  {{/* 사이트 전체 설정으로 덮어쓰기 */}}
  {{- with .Site.Params.post.license -}}
    {{- $.Scratch.Set "licenseConfig" (merge ($.Scratch.Get "licenseConfig") .) -}}
  {{- end -}}

  {{/* 개별 페이지 설정으로 덮어쓰기 */}}
  {{- with .Params.license -}}
    {{- $.Scratch.Set "licenseConfig" (merge ($.Scratch.Get "licenseConfig") .) -}}
  {{- end -}}

  {{/* 최종 설정을 변수로 가져오기 */}}
  {{- $licenseConfig := .Scratch.Get "licenseConfig" -}}


  {{/* 2. 라이선스 이름에 따라 i18n 키, URL, 표시될 이름 등을 동적으로 결정합니다. */}}
  {{- $descriptionKey := "" -}}
  {{- $licenseUrl := "" -}}
  {{- $displayName := "" -}}

  {{- if eq $licenseConfig.name "CC BY 4.0" -}}
    {{- $descriptionKey = "license.cc_by_desc" -}}
    {{- $licenseUrl = "https://creativecommons.org/licenses/by/4.0/" -}}
    {{- $displayName = "CC BY 4.0" -}}
  {{- else if eq $licenseConfig.name "CC BY-NC-SA 4.0" -}}
    {{- $descriptionKey = "license.cc_by_nc_sa_desc" -}}
    {{- $licenseUrl = "https://creativecommons.org/licenses/by-nc-sa/4.0/" -}}
    {{- $displayName = "CC BY-NC-SA 4.0" -}}
  {{- else -}}
    {{/* 다른 라이선스를 추가하고 싶다면 여기에 'else if' 구문을 추가하세요. */}}
    {{/* 기본값 처리 */}}
    {{- $descriptionKey = "license.cc_by_nc_sa_desc" -}}
    {{- $licenseUrl = $licenseConfig.url | default "https://creativecommons.org/licenses/by-nc-sa/4.0/" -}}
    {{- $displayName = $licenseConfig.displayName | default $licenseConfig.name -}}
  {{- end -}}


  <div class="post-license bg-muted/30 border-border mb-8 rounded-xl border p-6">
    <div class="flex items-start gap-4">
      <div
        class="bg-primary/10 flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg">
        {{ partial "features/icon.html" (dict "name" "license" "size" "lg" "ariaLabel" (T "license.title")) }}
      </div>

      <div class="flex-1">
        <h3 class="text-foreground mb-2 text-lg font-semibold">
          {{ T "license.title" }}
        </h3>

        <div class="text-muted-foreground space-y-2 text-sm">
          {{ with $licenseConfig.author }}
          <p>
            <strong>{{ T "license.author" }}:</strong>
            {{ . }}
          </p>
          {{ end }}

          <p>
            <strong>{{ T "license.link" }}:</strong>
            <a
              href="{{ .Permalink }}"
              class="text-primary hover:text-primary/80 transition-colors duration-200">
              {{ .Permalink }}
            </a>
          </p>

          <p>
            <strong>{{ T "license.type" }}:</strong>
            <a
              href="{{ $licenseUrl }}"
              target="_blank"
              rel="noopener noreferrer"
              class="text-primary hover:text-primary/80 transition-colors duration-200">
              {{ $displayName }}
            </a>
          </p>

          <p class="text-xs">
            {{ T $descriptionKey }}
          </p>
        </div>
      </div>
    </div>
  </div>
{{- end -}}